@page "/myorders"
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager

<div class="main">
  <p>Microsoft Learning module in this exercise:</p>
  <p>
    <div><b>Use pages, routing, and layouts to improve Blazor navigation</b></div>
    <ul>
      <li><a target="_blank" href="https://learn.microsoft.com/en-us/training/modules/use-pages-routing-layouts-control-blazor-navigation/3-exercise-change-navigation-blazor-using-page-directive">Exercise - Change navigation in your Blazor app by using the @@page directive</a></li>
      <li><a target="_blank" href="https://learn.microsoft.com/en-us/training/modules/use-pages-routing-layouts-control-blazor-navigation/5-exercise-route-parameters-improve-apps-navigation">Exercise - Use route parameters to improve your apps navigation</a></li>
    </ul>
  </p>

  @if (ordersWithStatus == null)
  {
    <text>Loading...</text>
  }
  else if (!ordersWithStatus.Any())
  {
    <h2>No orders placed</h2>
    <a class="btn btn-success" href="">Order some pizza</a>
  }
  else
  {
    <div class="list-group orders-list">
      @foreach (var item in ordersWithStatus)
      {
        <div class="list-group-item">
          <div class="col">
            <h5>@item.Order.CreatedTime.ToLongDateString()</h5>
            Items:
            <strong>@item.Order.Pizzas.Count()</strong>;
            Total price:
            <strong>£@item.Order.GetFormattedTotalPrice()</strong>
          </div>
          <div class="col">
            Status: <strong>@item.StatusText</strong>
          </div>
          @if (@item.StatusText != "Delivered")
          {
            <div class="col flex-grow-0">
              <a href="myorders/@item.Order.OrderId" class="btn btn-success">
                Track &gt;
              </a>
            </div>
          }
        </div>
      }
    </div>
  }
</div>

@code {
  List<OrderWithStatus> ordersWithStatus = new List<OrderWithStatus>();

  protected override async Task OnParametersSetAsync()
  {
    ordersWithStatus = await HttpClient.GetFromJsonAsync<List<OrderWithStatus>>(
        $"{NavigationManager.BaseUri}orders");
  }
}